import{r as b,x as z,s as P,l as Q,g as W,q as X,d as k,o as i,e as d,h as u,i as w,F as g,b as a,y as Y,k as x,a as D,j as I,f as U,t as p}from"./index-57ff8659.js";import{u as Z}from"./general-4d5aa9bd.js";import{l as S,_ as ee,a as B}from"./TextareaComponent-0882fd6c.js";import{a as ae,_ as v,F as le}from"./vee-validate-42a3978c.js";import{_ as q}from"./ImageUpload-6e248471.js";import{p as se,a as F}from"./preparedDataToFirebase-3ed6b348.js";import{r as V,d as f,J as R,V as L,c as te,a as oe,o as ne,e as ie,_ as ue,s as de,t as me}from"./index-08899976.js";import{v as H}from"./v4-a960c1f4.js";import"./index-8d32edcd.js";const re={key:0,class:"overlay overlay-page"},ce=a("i",{class:"fas fa-2x fa-sync-alt fa-spin"},null,-1),pe=[ce],ve={class:"d-flex mb-4"},fe=a("div",{class:"input__label-text"},"Схема залу",-1),_e={class:"mb-4"},he={class:"d-flex align-items-center mb-2"},be=a("div",{class:"input__label-text mr-2"},"Місця",-1),ge=["onClick"],Ve={class:"d-flex mb-4"},ye=a("div",{class:"input__label-text"},"Верхній банер",-1),ke={class:"mb-4"},we=a("div",{class:"mb-2"},[a("div",{class:"input__label-text"},"Галерея картинок"),a("div",{class:"input__label-text"},"Размер: 1000х190")],-1),xe={type:"button",class:"btn btn-info mb-4"},Ue={key:0,class:"d-flex flex-wrap"},Se=a("h4",{class:"text-center mb-4"},"Список сеансів",-1),qe={key:0,class:"table"},$e=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"#"),a("th",{scope:"col"},"Назва"),a("th",{scope:"col"},"Дата, час"),a("th",{scope:"col"},"Тип"),a("th",{scope:"col"},"Ціна"),a("th",{scope:"col"}),a("th",{scope:"col"})])],-1),Ce={scope:"row"},De={key:0},Ie=a("i",{class:"fa-solid fa-pen"},null,-1),Be=["onClick"],Fe=a("i",{class:"fa-solid fa-trash-can"},null,-1),Re=[Fe],Le={class:"seo-block"},He=a("h4",{class:"text-center mb-4"},"Seo блок",-1),Ne={type:"submit",class:"btn btn-success"},Te={key:0,class:"spinner-border spinner-border-sm",role:"status"},je=a("span",{class:"sr-only"},"Loading...",-1),Ee=[je],Me={key:1},Xe={__name:"AdminCinemaHallView",props:{cinemaId:{type:String}},setup(N){const T=N,$=Z(),t=b(null),y=b(!1),e=b({id:H(),cinema_id:null,created:null,seats:[],ua:{name:"",description:"",schema:{},banner:{},images:[],seo:{url:"",title:"",keywords:"",description:""}},ru:{name:"",description:"",schema:{},banner:{},images:[],seo:{url:"",title:"",keywords:"",description:""}}}),c=b([]);function j(n){if(n.target.files.length)for(let s=0;s<n.target.files.length;s++)e.value[t.value].images.push({fileId:H(),file:n.target.files[s]})}function E(){e.value[t.value].banner={}}function M(){e.value[t.value].schema={}}function A(){e.value.seats.push(0)}let _=[];function G(n){_.push(c.value[n].id),c.value.splice(n,1)}const J=z(),h=P();async function K(){if(ae()){y.value=!0;let s={id:e.value.id,cinema_id:e.value.cinema_id,seats:e.value.seats};for(let l in e.value)if(S.some(o=>o.value===l)){const o=await se(e.value[l].images,`halls/${e.value.id}`),m=await F(e.value[l].banner,`halls/${e.value.id}`),O=await F(e.value[l].schema,`halls/${e.value.id}`);s={...s,created:h.params.id?e.value.created:L(),[l]:{...e.value[l],images:o,banner:m,schema:O}}}const r=V(f,"halls",e.value.id);h.params.id?await te(r,s):await oe(r,s,{timestamp:L()}),_.length&&(_.forEach(l=>{ne(V(f,"seanses",l))}),_=[]),C(),await J.replace({name:"admin-cinemas-page",params:{id:e.value.cinema_id}}),y.value=!1}}async function C(){const n=ie(de(f,"seanses"),ue("hall_id","==",e.value.id)),s=await me(n);c.value=[],s.forEach(r=>{c.value.push(r.data())}),c.value.map(async(r,l)=>{const o=V(f,"films",r.film_id),m=await R(o);m.exists()&&(c.value[l].film=m.data())})}return Q(async()=>{if(t.value=S[0].value,h.params.id){const n=V(f,"halls",h.params.id),s=await R(n);s.exists()&&(e.value=s.data()),C()}}),W(()=>{e.value.cinema_id=T.cinemaId,$.isLoading=!1}),(n,s)=>{const r=X("router-link");return k($).isLoading?(i(),d("div",re,pe)):(i(),d(g,{key:1},[u(ee,{modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=l=>t.value=l),options:k(S),class:"mb-4"},null,8,["modelValue","options"]),u(k(le),{onSubmit:K},{default:w(()=>[u(v,{modelValue:e.value[t.value].name,"onUpdate:modelValue":s[1]||(s[1]=l=>e.value[t.value].name=l),name:"cinema-hall-name",label:"Назва залу",rules:"required",class:"col-3 mb-4"},null,8,["modelValue"]),u(B,{modelValue:e.value[t.value].description,"onUpdate:modelValue":s[2]||(s[2]=l=>e.value[t.value].description=l),name:"cinema-hall-description",label:"Опис залу",rules:"required",class:"mb-4"},null,8,["modelValue"]),a("div",ve,[fe,u(q,{modelValue:e.value[t.value].schema,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value[t.value].schema=l),onDeleteImage:M,name:"cinema-hall-banner","has-text":!1,"has-url":!1,class:"col-2"},null,8,["modelValue"])]),a("div",_e,[a("div",he,[be,a("button",{onClick:Y(A,["prevent","stop"]),type:"button",class:"btn btn-info"},"Додати ряд",8,ge)]),(i(!0),d(g,null,x(e.value.seats,(l,o)=>(i(),D(v,{modelValue:e.value.seats[o],"onUpdate:modelValue":m=>e.value.seats[o]=m,name:`cinema-hall-seats-${o}`,label:"Кількість місць в ряді",rules:"required|integer",class:"mb-4"},null,8,["modelValue","onUpdate:modelValue","name"]))),256))]),a("div",Ve,[ye,u(q,{modelValue:e.value[t.value].banner,"onUpdate:modelValue":s[4]||(s[4]=l=>e.value[t.value].banner=l),onDeleteImage:E,name:"cinema-hall-banner","has-text":!1,"has-url":!1,class:"col-2"},null,8,["modelValue"])]),a("div",ke,[we,a("label",xe,[I(" Додати фото "),a("input",{onChange:j,type:"file",multiple:"",accept:"image/png, image/jpeg, image/jpg, image/webp, image/svg",class:"image-upload__input"},null,32)]),e.value[t.value].images.length?(i(),d("div",Ue,[(i(!0),d(g,null,x(e.value[t.value].images,(l,o)=>(i(),D(q,{modelValue:e.value[t.value].images[o],"onUpdate:modelValue":m=>e.value[t.value].images[o]=m,onDeleteImage:m=>n.deleteItem(o),name:"cinema-hall-image","has-text":!1,"has-url":!1,class:"col-2 mb-2",key:`cinema-hall-image-${o}`},null,8,["modelValue","onUpdate:modelValue","onDeleteImage"]))),128))])):U("",!0)]),a("div",null,[Se,c.value.length?(i(),d("table",qe,[$e,a("tbody",null,[(i(!0),d(g,null,x(c.value,(l,o)=>(i(),d("tr",null,[a("th",Ce,p(o+1),1),l.film?(i(),d("td",De,p(l.film[t.value].name),1)):U("",!0),a("td",null,p(l.date)+" "+p(l.time),1),a("td",null,p(l.type),1),a("td",null,p(l.price),1),a("td",null,[u(r,{to:{name:"admin-seans-page",params:{id:l.id},query:{hall:e.value.id}}},{default:w(()=>[Ie]),_:2},1032,["to"])]),a("td",null,[a("button",{onClick:m=>G(o),type:"button"},Re,8,Be)])]))),256))])])):U("",!0),u(r,{to:{name:"admin-seans-page",query:{hall:e.value.id}},class:"btn btn-info mb-4"},{default:w(()=>[I("Додати сеанс ")]),_:1},8,["to"])]),a("div",Le,[He,u(v,{modelValue:e.value[t.value].seo.url,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value[t.value].seo.url=l),name:"seo-url",label:"URL",rules:"required",class:"mb-4"},null,8,["modelValue"]),u(v,{modelValue:e.value[t.value].seo.title,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value[t.value].seo.title=l),name:"seo-title",label:"Title",rules:"required",class:"mb-4"},null,8,["modelValue"]),u(v,{modelValue:e.value[t.value].seo.keywords,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value[t.value].seo.keywords=l),name:"seo-keywords",label:"Keywords",rules:"required",class:"mb-4"},null,8,["modelValue"]),u(B,{modelValue:e.value[t.value].seo.description,"onUpdate:modelValue":s[8]||(s[8]=l=>e.value[t.value].seo.description=l),name:"seo-description",label:"Description",rules:"required",class:"mb-4"},null,8,["modelValue"])]),a("button",Ne,[y.value?(i(),d("div",Te,Ee)):(i(),d("span",Me,"Зберегти"))])]),_:1})],64))}}};export{Xe as default};
