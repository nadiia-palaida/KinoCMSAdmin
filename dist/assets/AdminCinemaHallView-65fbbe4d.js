import{r as b,x as z,s as P,l as Q,g as W,q as X,d as k,o as i,e as d,h as u,i as w,F as g,b as a,y as Y,k as x,a as C,j as D,f as U,t as p}from"./index-49708047.js";import{u as Z}from"./general-332ba11c.js";import{l as S,_ as ee,a as I}from"./TextareaComponent-21f0aea7.js";import{a as ae,_ as v,F as le}from"./vee-validate-c2eed9a0.js";import{_ as q}from"./ImageUpload-e549be2c.js";import{p as se,a as B}from"./preparedDataToFirebase-3ed6b348.js";import{r as V,d as f,J as F,V as R,c as te,a as oe,o as ne,t as ie,s as ue}from"./index-08899976.js";import{v as L}from"./v4-a960c1f4.js";import"./index-403c6953.js";const de={key:0,class:"overlay overlay-page"},me=a("i",{class:"fas fa-2x fa-sync-alt fa-spin"},null,-1),re=[me],ce={class:"d-flex mb-4"},pe=a("div",{class:"input__label-text"},"Схема залу",-1),ve={class:"mb-4"},fe={class:"d-flex align-items-center mb-2"},_e=a("div",{class:"input__label-text mr-2"},"Місця",-1),he=["onClick"],be={class:"d-flex mb-4"},ge=a("div",{class:"input__label-text"},"Верхній банер",-1),Ve={class:"mb-4"},ye=a("div",{class:"mb-2"},[a("div",{class:"input__label-text"},"Галерея картинок"),a("div",{class:"input__label-text"},"Размер: 1000х190")],-1),ke={type:"button",class:"btn btn-info mb-4"},we={key:0,class:"d-flex flex-wrap"},xe=a("h4",{class:"text-center mb-4"},"Список сеансів",-1),Ue={key:0,class:"table"},Se=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"#"),a("th",{scope:"col"},"Назва"),a("th",{scope:"col"},"Дата, час"),a("th",{scope:"col"},"Тип"),a("th",{scope:"col"},"Ціна"),a("th",{scope:"col"}),a("th",{scope:"col"})])],-1),qe={scope:"row"},$e={key:0},Ce=a("i",{class:"fa-solid fa-pen"},null,-1),De=["onClick"],Ie=a("i",{class:"fa-solid fa-trash-can"},null,-1),Be=[Ie],Fe={class:"seo-block"},Re=a("h4",{class:"text-center mb-4"},"Seo блок",-1),Le={type:"submit",class:"btn btn-success"},He={key:0,class:"spinner-border spinner-border-sm",role:"status"},Ne=a("span",{class:"sr-only"},"Loading...",-1),Te=[Ne],je={key:1},Qe={__name:"AdminCinemaHallView",props:{cinemaId:{type:String}},setup(H){const N=H,$=Z(),t=b(null),y=b(!1),e=b({id:L(),cinema_id:null,created:null,seats:[],ua:{name:"",description:"",schema:{},banner:{},images:[],seo:{url:"",title:"",keywords:"",description:""}},ru:{name:"",description:"",schema:{},banner:{},images:[],seo:{url:"",title:"",keywords:"",description:""}}}),m=b([]);function T(n){if(n.target.files.length)for(let s=0;s<n.target.files.length;s++)e.value[t.value].images.push({fileId:L(),file:n.target.files[s]})}function j(){e.value[t.value].banner={}}function E(){e.value[t.value].schema={}}function M(){e.value.seats.push(0)}let _=[];function A(n){_.push(m.value[n].id),m.value.splice(n,1)}const G=z(),h=P();async function J(){if(ae()){y.value=!0;let s={id:e.value.id,cinema_id:e.value.cinema_id,seats:e.value.seats};for(let l in e.value)if(S.some(o=>o.value===l)){const o=await se(e.value[l].images,`halls/${e.value.id}`),c=await B(e.value[l].banner,`halls/${e.value.id}`),O=await B(e.value[l].schema,`halls/${e.value.id}`);s={...s,created:h.params.id?e.value.created:R(),[l]:{...e.value[l],images:o,banner:c,schema:O}}}const r=V(f,"halls",e.value.id);h.params.id?await te(r,s):await oe(r,s,{timestamp:R()}),_.length&&(_.forEach(l=>{ne(V(f,"seanses",l))}),_=[]),await G.replace({name:"admin-cinemas-page",params:{id:e.value.cinema_id}}),y.value=!1}}async function K(){const n=await ie(ue(f,"seanses"));m.value=[],n.forEach(s=>{m.value.push(s.data())}),m.value.map(async(s,r)=>{const l=V(f,"films",s.film_id),o=await F(l);o.exists()&&(m.value[r].film=o.data())})}return Q(async()=>{if(t.value=S[0].value,h.params.id){const n=V(f,"halls",h.params.id),s=await F(n);s.exists()&&(e.value=s.data()),K()}}),W(()=>{e.value.cinema_id=N.cinemaId,$.isLoading=!1}),(n,s)=>{const r=X("router-link");return k($).isLoading?(i(),d("div",de,re)):(i(),d(g,{key:1},[u(ee,{modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=l=>t.value=l),options:k(S),class:"mb-4"},null,8,["modelValue","options"]),u(k(le),{onSubmit:J},{default:w(()=>[u(v,{modelValue:e.value[t.value].name,"onUpdate:modelValue":s[1]||(s[1]=l=>e.value[t.value].name=l),name:"cinema-hall-name",label:"Назва залу",rules:"required",class:"col-3 mb-4"},null,8,["modelValue"]),u(I,{modelValue:e.value[t.value].description,"onUpdate:modelValue":s[2]||(s[2]=l=>e.value[t.value].description=l),name:"cinema-hall-description",label:"Опис залу",rules:"required",class:"mb-4"},null,8,["modelValue"]),a("div",ce,[pe,u(q,{modelValue:e.value[t.value].schema,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value[t.value].schema=l),onDeleteImage:E,name:"cinema-hall-banner","has-text":!1,"has-url":!1,class:"col-2"},null,8,["modelValue"])]),a("div",ve,[a("div",fe,[_e,a("button",{onClick:Y(M,["prevent","stop"]),type:"button",class:"btn btn-info"},"Додати ряд",8,he)]),(i(!0),d(g,null,x(e.value.seats,(l,o)=>(i(),C(v,{modelValue:e.value.seats[o],"onUpdate:modelValue":c=>e.value.seats[o]=c,name:`cinema-hall-seats-${o}`,label:"Кількість місць в ряді",rules:"required|integer",class:"mb-4"},null,8,["modelValue","onUpdate:modelValue","name"]))),256))]),a("div",be,[ge,u(q,{modelValue:e.value[t.value].banner,"onUpdate:modelValue":s[4]||(s[4]=l=>e.value[t.value].banner=l),onDeleteImage:j,name:"cinema-hall-banner","has-text":!1,"has-url":!1,class:"col-2"},null,8,["modelValue"])]),a("div",Ve,[ye,a("label",ke,[D(" Додати фото "),a("input",{onChange:T,type:"file",multiple:"",accept:"image/png, image/jpeg, image/jpg, image/webp, image/svg",class:"image-upload__input"},null,32)]),e.value[t.value].images.length?(i(),d("div",we,[(i(!0),d(g,null,x(e.value[t.value].images,(l,o)=>(i(),C(q,{modelValue:e.value[t.value].images[o],"onUpdate:modelValue":c=>e.value[t.value].images[o]=c,onDeleteImage:c=>n.deleteItem(o),name:"cinema-hall-image","has-text":!1,"has-url":!1,class:"col-2 mb-2",key:`cinema-hall-image-${o}`},null,8,["modelValue","onUpdate:modelValue","onDeleteImage"]))),128))])):U("",!0)]),a("div",null,[xe,m.value.length?(i(),d("table",Ue,[Se,a("tbody",null,[(i(!0),d(g,null,x(m.value,(l,o)=>(i(),d("tr",null,[a("th",qe,p(o+1),1),l.film?(i(),d("td",$e,p(l.film[t.value].name),1)):U("",!0),a("td",null,p(l.date)+" "+p(l.time),1),a("td",null,p(l.type),1),a("td",null,p(l.price),1),a("td",null,[u(r,{to:{name:"admin-seans-page",params:{id:l.id},query:{hall:e.value.id}}},{default:w(()=>[Ce]),_:2},1032,["to"])]),a("td",null,[a("button",{onClick:c=>A(o),type:"button"},Be,8,De)])]))),256))])])):U("",!0),u(r,{to:{name:"admin-seans-page",query:{hall:e.value.id}},class:"btn btn-info mb-4"},{default:w(()=>[D("Додати сеанс ")]),_:1},8,["to"])]),a("div",Fe,[Re,u(v,{modelValue:e.value[t.value].seo.url,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value[t.value].seo.url=l),name:"seo-url",label:"URL",rules:"required",class:"mb-4"},null,8,["modelValue"]),u(v,{modelValue:e.value[t.value].seo.title,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value[t.value].seo.title=l),name:"seo-title",label:"Title",rules:"required",class:"mb-4"},null,8,["modelValue"]),u(v,{modelValue:e.value[t.value].seo.keywords,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value[t.value].seo.keywords=l),name:"seo-keywords",label:"Keywords",rules:"required",class:"mb-4"},null,8,["modelValue"]),u(I,{modelValue:e.value[t.value].seo.description,"onUpdate:modelValue":s[8]||(s[8]=l=>e.value[t.value].seo.description=l),name:"seo-description",label:"Description",rules:"required",class:"mb-4"},null,8,["modelValue"])]),a("button",Le,[y.value?(i(),d("div",He,Te)):(i(),d("span",je,"Зберегти"))])]),_:1})],64))}}};export{Qe as default};
