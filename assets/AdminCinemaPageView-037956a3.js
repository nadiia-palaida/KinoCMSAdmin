import{_ as P}from"./TabsComponent-2b439d40.js";import{_,F as Y,a as W}from"./InputComponent-926cc09d.js";import{_ as D}from"./TextareaComponent-3fceddef.js";import{_ as $}from"./ImageUpload-734539ec.js";import{r as b,x as z,s as J,l as Q,g as oe,d as k,o as d,e as v,h as m,i as X,b as l,y as ne,F as w,k as L,a as S,j as Z,f as I,t as M}from"./index-5ccc9495.js";import{u as ee}from"./general-e95eafb2.js";import{l as U}from"./languages-14535d94.js";import{p as le,a as B}from"./preparedDataToFirebase-469b79a8.js";import{V as ue,r as N,d as T,b as ie,a as O,o as de}from"./index-2c7431f0.js";import{v as F}from"./v4-a960c1f4.js";import{h as me}from"./moment-fbc5633a.js";import{a as re,g as ce}from"./queriesFirestore-d3fa99f6.js";import"./vee-validate-6f28d402.js";import"./index-dbcece3d.js";const ve={key:0,class:"overlay overlay-page"},pe=l("i",{class:"fas fa-2x fa-sync-alt fa-spin"},null,-1),fe=[pe],be={class:"d-flex mb-4"},_e=l("div",{class:"input__label-text"},"Схема залу",-1),ge={class:"mb-4"},he={class:"d-flex align-items-center mb-2"},Ve=l("div",{class:"input__label-text mr-2"},"Місця",-1),ye=["onClick"],$e={class:"d-flex mb-4"},ke=l("div",{class:"input__label-text"},"Верхній банер",-1),we={class:"mb-4"},Ue=l("div",{class:"mb-2"},[l("div",{class:"input__label-text"},"Галерея картинок"),l("div",{class:"input__label-text"},"Размер: 1000х190")],-1),xe={type:"button",class:"btn btn-info mb-4"},He={key:0,class:"d-flex flex-wrap"},Ie={class:"seo-block"},De=l("h4",{class:"text-center mb-4"},"Seo блок",-1),Ce={type:"submit",class:"btn btn-success"},qe={key:0,class:"spinner-border spinner-border-sm",role:"status"},Le=l("span",{class:"sr-only"},"Loading...",-1),Se=[Le],Be={key:1},Fe={__name:"CinemaHall",props:{cinemaId:{type:String},hall:{type:Object}},emits:["updateHall","createHall"],setup(K,{emit:x}){const t=K,y=ee(),e=b(null),p=b(!1),a=b({id:F(),cinema_id:null,created:null,seats:[],ua:{name:"",description:"",schema:{},banner:{},images:[],seo:{url:"",title:"",keywords:"",description:""}},ru:{name:"",description:"",schema:{},banner:{},images:[],seo:{url:"",title:"",keywords:"",description:""}}});function H(h){if(h.target.files.length)for(let n=0;n<h.target.files.length;n++)a.value[e.value].images.push({fileId:F(),file:h.target.files[n]})}function g(){a.value[e.value].banner={}}function C(){a.value[e.value].schema={}}function R(){a.value.seats.push(0)}const j=z(),A=J();async function q(){if(W()){p.value=!0;let n={id:a.value.id,cinema_id:a.value.cinema_id,seats:a.value.seats};for(let u in a.value)if(U.some(c=>c.value===u)){const c=await le(a.value[u].images,`halls/${a.value.id}`),V=await B(a.value[u].banner,`halls/${a.value.id}`),E=await B(a.value[u].schema,`halls/${a.value.id}`);n={...n,created:A.params.id?a.value.created:ue(),[u]:{...a.value[u],images:c,banner:V,schema:E}}}t.hall?x("updateHall",n):x("createHall",n),await j.replace({name:"admin-cinemas-page",params:{id:a.value.cinema_id}}),p.value=!1}}return Q(async()=>{e.value=U[0].value,t.hall&&(a.value=t.hall)}),oe(()=>{a.value.cinema_id=t.cinemaId,y.isLoading=!1}),(h,n)=>k(y).isLoading?(d(),v("div",ve,fe)):(d(),v(w,{key:1},[m(P,{modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=u=>e.value=u),options:k(U),class:"mb-4"},null,8,["modelValue","options"]),m(k(Y),{onSubmit:q},{default:X(()=>[m(_,{modelValue:a.value[e.value].name,"onUpdate:modelValue":n[1]||(n[1]=u=>a.value[e.value].name=u),name:"cinema-hall-name",label:"Назва залу",rules:"required",class:"col-3 mb-4"},null,8,["modelValue"]),m(D,{modelValue:a.value[e.value].description,"onUpdate:modelValue":n[2]||(n[2]=u=>a.value[e.value].description=u),name:"cinema-hall-description",label:"Опис залу",rules:"required",class:"mb-4"},null,8,["modelValue"]),l("div",be,[_e,m($,{modelValue:a.value[e.value].schema,"onUpdate:modelValue":n[3]||(n[3]=u=>a.value[e.value].schema=u),onDeleteImage:C,name:"cinema-hall-schema","has-text":!1,"has-url":!1,class:"col-2"},null,8,["modelValue"])]),l("div",ge,[l("div",he,[Ve,l("button",{onClick:ne(R,["prevent","stop"]),type:"button",class:"btn btn-info"},"Додати ряд",8,ye)]),(d(!0),v(w,null,L(a.value.seats,(u,c)=>(d(),S(_,{modelValue:a.value.seats[c],"onUpdate:modelValue":V=>a.value.seats[c]=V,name:`cinema-hall-seats-${c}`,label:"Кількість місць в ряді",rules:"required|integer",class:"mb-4"},null,8,["modelValue","onUpdate:modelValue","name"]))),256))]),l("div",$e,[ke,m($,{modelValue:a.value[e.value].banner,"onUpdate:modelValue":n[4]||(n[4]=u=>a.value[e.value].banner=u),onDeleteImage:g,name:"cinema-hall-banner","has-text":!1,"has-url":!1,class:"col-2"},null,8,["modelValue"])]),l("div",we,[Ue,l("label",xe,[Z(" Додати фото "),l("input",{onChange:H,type:"file",multiple:"",accept:"image/png, image/jpeg, image/jpg, image/webp, image/svg",class:"image-upload__input"},null,32)]),a.value[e.value].images.length?(d(),v("div",He,[(d(!0),v(w,null,L(a.value[e.value].images,(u,c)=>(d(),S($,{modelValue:a.value[e.value].images[c],"onUpdate:modelValue":V=>a.value[e.value].images[c]=V,onDeleteImage:V=>h.deleteItem(c),name:"cinema-hall-image","has-text":!1,"has-url":!1,class:"col-2 mb-2",key:`cinema-hall-image-${c}`},null,8,["modelValue","onUpdate:modelValue","onDeleteImage"]))),128))])):I("",!0)]),l("div",Ie,[De,m(_,{modelValue:a.value[e.value].seo.url,"onUpdate:modelValue":n[5]||(n[5]=u=>a.value[e.value].seo.url=u),name:"seo-url",label:"URL",rules:"required",class:"mb-4"},null,8,["modelValue"]),m(_,{modelValue:a.value[e.value].seo.title,"onUpdate:modelValue":n[6]||(n[6]=u=>a.value[e.value].seo.title=u),name:"seo-title",label:"Title",rules:"required",class:"mb-4"},null,8,["modelValue"]),m(_,{modelValue:a.value[e.value].seo.keywords,"onUpdate:modelValue":n[7]||(n[7]=u=>a.value[e.value].seo.keywords=u),name:"seo-keywords",label:"Keywords",rules:"required",class:"mb-4"},null,8,["modelValue"]),m(D,{modelValue:a.value[e.value].seo.description,"onUpdate:modelValue":n[8]||(n[8]=u=>a.value[e.value].seo.description=u),name:"seo-description",label:"Description",rules:"required",class:"mb-4"},null,8,["modelValue"])]),l("button",Ce,[p.value?(d(),v("div",qe,Se)):(d(),v("span",Be,"Зберегти"))])]),_:1})],64))}},Re={key:0,class:"overlay overlay-page"},je=l("i",{class:"fas fa-2x fa-sync-alt fa-spin"},null,-1),Ae=[je],Ee={key:0},Ge={class:"d-flex mb-4"},Me=l("div",{class:"input__label-text"},"Логотип",-1),Ne={class:"d-flex mb-4"},Te=l("div",{class:"input__label-text"},"Фото верхнего баннера",-1),Ke={class:"mb-4"},Oe=l("div",{class:"mb-2"},[l("div",{class:"input__label-text"},"Галерея картинок"),l("div",{class:"input__label-text"},"Размер: 1000х190")],-1),Pe={type:"button",class:"btn btn-info mb-4"},Ye={key:0,class:"d-flex flex-wrap"},We=l("h4",{class:"text-center mb-4"},"Список залів",-1),ze={key:0,class:"table"},Je=l("thead",null,[l("tr",null,[l("th",{scope:"col"},"#"),l("th",{scope:"col"},"Назва"),l("th",{scope:"col"},"Дата створення"),l("th",{scope:"col"}),l("th",{scope:"col"})])],-1),Qe={scope:"row"},Xe=["onClick"],Ze=l("i",{class:"fa-solid fa-pen"},null,-1),el=[Ze],ll=["onClick"],al=l("i",{class:"fa-solid fa-trash-can"},null,-1),sl=[al],tl={class:"seo-block"},ol=l("h4",{class:"text-center mb-4"},"Seo блок",-1),nl={type:"submit",class:"btn btn-success"},ul={key:0,class:"spinner-border spinner-border-sm",role:"status"},il=l("span",{class:"sr-only"},"Loading...",-1),dl=[il],ml={key:1},Ul={__name:"AdminCinemaPageView",setup(K){const x=ee(),t=b(null),y=b(!1),e=b({id:F(),ua:{name:"",description:"",condition:"",logo:{},banner:{},images:[],seo:{url:"",title:"",keywords:"",description:""}},ru:{name:"",description:"",condition:"",logo:{},banner:{},images:[],seo:{url:"",title:"",keywords:"",description:""}}}),p=b([]),a="cinema-page",H="hall-page",g=b(a),C=b(null);function R(i){return i?me(i.toDate()).format("DD.MM.YYYY"):null}function j(i){if(i.target.files.length)for(let s=0;s<i.target.files.length;s++)e.value[t.value].images.push({fileId:F(),file:i.target.files[s]})}function A(i){e.value[t.value].images.splice(i,1)}function q(i){e.value[t.value][i]={}}function h(i){console.log("hall",i),p.value.push(i),g.value=a}function n(i){C.value=p.value[i],g.value=H}function u(i){let s=p.value.findIndex(o=>o.id===i.id);p.value[s]=i,g.value=a}let c=[];function V(i){c.push(p.value[i].id),p.value.splice(i,1)}const E=z(),G=J();async function ae(){if(W()){y.value=!0;let s={id:e.value.id};for(let r in e.value)if(U.some(f=>f.value===r)){const f=await le(e.value[r].images,`cinemas/${e.value.id}`),se=await B(e.value[r].logo,`cinemas/${e.value.id}`),te=await B(e.value[r].banner,`cinemas/${e.value.id}`);s={...s,[r]:{...e.value[r],images:f,logo:se,banner:te}}}const o=N(T,"cinemas",e.value.id);G.params.id?await ie(o,s):await O(o,s),p.value.forEach(async r=>{const f=N(T,"halls",r.id);await O(f,r)}),c.length&&(c.forEach(async r=>{await de(N(T,"halls",r))}),c=[]),await E.replace({name:"admin-cinemas"}),y.value=!1}}return Q(async()=>{t.value=U[0].value,G.params.id&&(e.value=await re("cinemas",G.params.id),p.value=await ce("halls",["cinema_id","==",e.value.id])),x.isLoading=!1}),(i,s)=>k(x).isLoading?(d(),v("div",Re,Ae)):(d(),v(w,{key:1},[g.value===a?(d(),v("div",Ee,[m(P,{modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=o=>t.value=o),options:k(U),class:"mb-4"},null,8,["modelValue","options"]),m(k(Y),{onSubmit:ae},{default:X(()=>[m(_,{modelValue:e.value[t.value].name,"onUpdate:modelValue":s[1]||(s[1]=o=>e.value[t.value].name=o),name:"cinema-name",label:"Назва кінотеатру",rules:"required",class:"col-3 mb-4"},null,8,["modelValue"]),m(D,{modelValue:e.value[t.value].description,"onUpdate:modelValue":s[2]||(s[2]=o=>e.value[t.value].description=o),name:"cinema-description",label:"Опис",rules:"required",class:"mb-4"},null,8,["modelValue"]),m(D,{modelValue:e.value[t.value].condition,"onUpdate:modelValue":s[3]||(s[3]=o=>e.value[t.value].condition=o),name:"cinema-condition",label:"Умова",rules:"required",class:"mb-4"},null,8,["modelValue"]),l("div",Ge,[Me,m($,{modelValue:e.value[t.value].logo,"onUpdate:modelValue":s[4]||(s[4]=o=>e.value[t.value].logo=o),onDeleteImage:s[5]||(s[5]=o=>q("logo")),name:"cinema-logo","has-text":!1,"has-url":!1,class:"col-2"},null,8,["modelValue"])]),l("div",Ne,[Te,m($,{modelValue:e.value[t.value].banner,"onUpdate:modelValue":s[6]||(s[6]=o=>e.value[t.value].banner=o),onDeleteImage:s[7]||(s[7]=o=>q("banner")),name:"cinema-banner","has-text":!1,"has-url":!1,class:"col-2"},null,8,["modelValue"])]),l("div",Ke,[Oe,l("label",Pe,[Z(" Додати фото "),l("input",{onChange:j,type:"file",multiple:"",accept:"image/png, image/jpeg, image/jpg, image/webp, image/svg",class:"image-upload__input"},null,32)]),e.value[t.value].images.length?(d(),v("div",Ye,[(d(!0),v(w,null,L(e.value[t.value].images,(o,r)=>(d(),S($,{modelValue:e.value[t.value].images[r],"onUpdate:modelValue":f=>e.value[t.value].images[r]=f,onDeleteImage:f=>A(r),name:"cinema-image","has-text":!1,"has-url":!1,class:"col-2 mb-2",key:`cinema-image-${r}`},null,8,["modelValue","onUpdate:modelValue","onDeleteImage"]))),128))])):I("",!0)]),l("div",null,[We,p.value.length?(d(),v("table",ze,[Je,l("tbody",null,[(d(!0),v(w,null,L(p.value,(o,r)=>(d(),v("tr",null,[l("th",Qe,M(r+1),1),l("td",null,M(o[t.value].name),1),l("td",null,M(R(o.created)),1),l("td",null,[l("button",{onClick:f=>n(r),type:"button"},el,8,Xe)]),l("td",null,[l("button",{onClick:f=>V(r),type:"button"},sl,8,ll)])]))),256))])])):I("",!0),l("button",{onClick:s[8]||(s[8]=o=>g.value=H),type:"button",class:"btn btn-info mb-4"},"Додати зал")]),l("div",tl,[ol,m(_,{modelValue:e.value[t.value].seo.url,"onUpdate:modelValue":s[9]||(s[9]=o=>e.value[t.value].seo.url=o),name:"seo-url",label:"URL",rules:"required",class:"mb-4"},null,8,["modelValue"]),m(_,{modelValue:e.value[t.value].seo.title,"onUpdate:modelValue":s[10]||(s[10]=o=>e.value[t.value].seo.title=o),name:"seo-title",label:"Title",rules:"required",class:"mb-4"},null,8,["modelValue"]),m(_,{modelValue:e.value[t.value].seo.keywords,"onUpdate:modelValue":s[11]||(s[11]=o=>e.value[t.value].seo.keywords=o),name:"seo-keywords",label:"Keywords",rules:"required",class:"mb-4"},null,8,["modelValue"]),m(D,{modelValue:e.value[t.value].seo.description,"onUpdate:modelValue":s[12]||(s[12]=o=>e.value[t.value].seo.description=o),name:"seo-description",label:"Description",rules:"required",class:"mb-4"},null,8,["modelValue"])]),l("button",nl,[y.value?(d(),v("div",ul,dl)):(d(),v("span",ml,"Зберегти"))])]),_:1})])):I("",!0),g.value===H?(d(),S(Fe,{key:1,cinemaId:e.value.id,hall:C.value,onCreateHall:h,onUpdateHall:u},null,8,["cinemaId","hall"])):I("",!0)],64))}};export{Ul as default};
